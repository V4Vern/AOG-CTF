# Login 

Difficulty Level: Warmup
 
Oh noooo I forgot my credentials to the server! I'm pretty sure I wrote it somewhere the ***source code*** but I can't figure out where!
 
Connect via `nc challenge.ctf-fun.xyz 14001`
 
PS: Challenges in this category require a linux environment read [here](https://docs.google.com/document/d/13RjL_RWibA9xYOKvSCXpTGG0D2ZYa3kDzprGNa8ypeA/edit?usp=sharing) for a guide to installing a linux VM

### Hints

- [strcmp](https://https://www.tutorialspoint.com/c_standard_library/c_function_strcmp.htm) compares between two words. Find out what is buffer comparing to. 
P.S: `\n` is a newline, you can ignore that when typing the answer


## Deployment

```bash
cd service
sudo ./login.sh &
```

## Solution

In this challenge, we look into learning how to read code, specifically C code. Opening the login.c file we see there’s two functions, print_flag and main. 

```c
#include <stdio.h>
#include <string.h>
#include <stdlib.h>

#define FLAGSIZE 64

void print_flag(){
	char flag[FLAGSIZE];

	FILE *f = fopen("flag.txt","r");
	if (f == NULL) {
		printf("Flag File is Missing.\n");
		exit(0);
	}

	fgets(flag,FLAGSIZE,f);
	printf(flag);
}

int main(int argc, char** argv) {
	setvbuf(stdout, NULL, _IONBF, 0);

	char buffer[32] = {0x00};

	printf("%s", "Login: ");
	fgets(buffer, sizeof(buffer), stdin);

	if (strcmp(buffer, "Weje\n") == 0){
		printf("%s", "Password: ");
		fgets(buffer, sizeof(buffer), stdin);

		if (strcmp(buffer, "P@SSW0RD\n") == 0){
			printf("%s\n", "Login passed! Here is your flag.");
			print_flag();
		} else {
			printf("%s\n", "Invalid password!");
		}
	} else {
		printf("%s\n", "Invalid Username.");
	}

}
```

We see that print_flag function is the one that we want to call so let’s find the where it is called. We see that it is called when following conditions are met:
- strcmp(buffer, “Weje\n) == 0
- strcmp(buffer, “P@SSW0RD\n) == 0

```c
fgets(buffer, sizeof(buffer), stdin);

	if (strcmp(buffer, "Weje\n") == 0){
		printf("%s", "Password: ");
		fgets(buffer, sizeof(buffer), stdin);

		if (strcmp(buffer, "P@SSW0RD\n") == 0){
			printf("%s\n", "Login passed! Here is your flag.");
			print_flag();
```

This means we need to set buffer to “Weje\n” first then afterwards “P@SSW0RD\n”.

Now we to find the method that allows us to set buffer, which is [fgets](https://www.tutorialspoint.com/c_standard_library/c_function_fgets.htm)

Quoting tutorialspoint:
> The C library function `char *fgets(char *str, int n, FILE *stream)` reads a line from the specified stream and stores it into the string pointed by **str**. It stops when either **(n-1)** characters are read, the newline character is read, or the end-of-file is reached, whichever comes first

So for `fgets(buffer, sizeof(buffer), stdin)` we are reading input equal to the size of the buffer (32) from the Standard Input.

Note that for fgets, it stops either when n-1 characters (31) are read or a newline character (\n) is read. Whenever we press enter, it will give us a newline. So when we interact with the binary and type “Hello” and press enter, we give the input “Hello\n”. Thus to meet the conditions we just need to provide the words without the newline as it is provided when we press enter.

Another thing to note is that the main is usually the first function to be called so we don’t need to figure out who calls main.

```bash
nc challenge.ctf-fun.xyz 14001
Login: Weje
Password: P@SSW0RD
Login passed: Here is your flag.
19C4{L0g1n_successf00l}
```

### Flag
19C4{L0g1n_successf00l}